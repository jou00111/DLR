# デプロイ時に遭遇した問題

デプロイ時にエラーになると、ブラウザの画面では"ごめん！なんか問題おきてるみたい..."的なニュアンスのメッセージしか表示されない
正しいエラーを確認するにはターミナルで ` tail -f log/production.log ` を実行した後に、もう一度エラーを発生させる事で正確に確認出来る

## webpackerあーだこーだ

下記は確認したエラーメッセージの一部
```
[5c41acfd-91d5-44b6-a345-d8339febce67] ActionView::Template::Error (Webpacker can't find application.css in /home/ec2-user/DLR/public/packs/manifest.json. Possible causes:
1. You want to set webpacker.yml value of compile to true for your environment
   unless you are using the `webpack -w` or the webpack-dev-server.
2. webpack has not yet re-run to reflect updates.
3. You have misconfigured Webpacker's config/webpacker.yml file.
4. Your webpack configuration is not creating a manifest.
```

このケースではコマンドのやり忘れやエラーが想定される

`bundle exec rails assets:precompile RAILS_ENV=production`
このコマンドを実行してエラーが無いかチェックしよう
エラーが無ければやり忘れっぽいので、そのままrailsを再起動して確認する

```
kill $(cat tmp/pids/puma.pid)
rails s -e production
```





Zeitwerk::NameError
expected file /home/ec2-user/environment/DLR/app/controllers/homes_controller.rb to define constant HomesController, but didn't

コントローラーが見つからない場合に発生しやすい
→今回の場合publicフォルダ内にコントローラーがなかったためはっせい




Uncaught TypeError: $(...).raty is not a function
    at HTMLDocument.<anonymous> (<anonymous>:13:11)
    at ./node_modules/turbolinks/dist/turbolinks.js.e.dispatch (turbolinks.js:68:1)
    at r.notifyApplicationAfterPageLoad (turbolinks.js:885:1)
    at r.visitCompleted (turbolinks.js:898:1)
    at r.complete (turbolinks.js:676:1)
    at r.<anonymous> (turbolinks.js:706:1)
    at turbolinks.js:755:1

ratyがうまく作動していないエラーが発生した。
bin/webpack で試したが、あまり効果はない
import Raty from "raty.js"; // Raty.jsのインポート
bootstrapが消えた....おそらくjqaryの問題

解決はしたが、別手順としてjavascriptに追加





> Booting Puma
=> Rails 6.1.7.10 application starting in development 
=> Run bin/rails server --help for more startup options
A server is already running. Check /home/ec2-user/environment/DLR/tmp/pids/server.pid.

pumaがすでに起動していて　rails s　でサーバーが表示できなくなった。
→$ lsof -i :3000 でidを確認後
kill -9  id
bin/rails server 
で解決



コメント送信を行ったが、テーブルに保存されない

Started POST "/posts/1/post_comments" for 127.0.0.1 at 2024-11-15 11:54:29 +0000
Processing by Public::PostCommentsController#create as HTML
  Parameters: {"authenticity_token"=>"[FILTERED]", "post_comment"=>{"title"=>"dd", "body"=>"dd", "star"=>"3"}, "commit"=>"Create Post comment", "post_id"=>"1"}
  Post Load (0.1ms)  SELECT "posts".* FROM "posts" WHERE "posts"."id" = ? LIMIT ?  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/public/post_comments_controller.rb:10:in `create'
  User Load (0.1ms)  SELECT "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/public/post_comments_controller.rb:11:in `create'
Redirected to http://localhost:3000/posts/1
Failed to save PostComment: ["Post must exist"]
Completed 302 Found in 9ms (ActiveRecord: 0.2ms | Allocations: 4681)

コントローラーとモデルでの関連付けを要確認
解決　→ユーザー側の関連付けを忘れていた